<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Leesa">
<meta name="dcterms.date" content="2024-02-19">
<meta name="description" content="What happens when we try to get a little romance out of ChatGPT?">

<title>RoboTalk - Storybook Struggles (Part II)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">RoboTalk</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Storybook Struggles (Part II)</h1>
                  <div>
        <div class="description">
          What happens when we try to get a little romance out of ChatGPT?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">prompting</div>
                <div class="quarto-category">text generation</div>
                <div class="quarto-category">text analysis</div>
                <div class="quarto-category">computer vision</div>
                <div class="quarto-category">image generation</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Leesa </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 19, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="storybook-struggles-part-ii" class="level2">
<h2 class="anchored" data-anchor-id="storybook-struggles-part-ii">Storybook Struggles (Part II)</h2>
<p>Valentine’s Day is technically over, but that doesn’t mean that love is dead!</p>
<p>Below I’ve continued with my effort to get ChatGPT to write me a story that I’ll enjoy.</p>
<section id="love-in-darkness" class="level3">
<h3 class="anchored" data-anchor-id="love-in-darkness">Love in darkness</h3>
<p>In Part I, I tried to get ChatGPT to write me a horror-themed love story - however, I really let myself get distracted by the system’s word count function…</p>
<p>In this post, we’ll continue to explore ChatGPT’s creativity.</p>
<p>This is the story we had by the end of the last post:</p>
<blockquote class="blockquote">
<p>In a realm where shadows reigned supreme, Evan found himself lost, wandering amidst the whispers of the past that clung to him like a second skin. It was in this realm of eternal night that Lila appeared, a luminous beacon in the oppressive darkness. Her presence was a balm to his frayed edges, a light guiding him back from the brink of despair.</p>
</blockquote>
<blockquote class="blockquote">
<p>Their love was an unexpected gift, a rare bloom in the heart of a shadowed forest. It was a love that spoke in soft whispers and tender touches, a promise made in the silent communion of their souls. Together, they forged a sanctuary amidst the darkness, a haven where light reigned supreme.</p>
</blockquote>
<blockquote class="blockquote">
<p>The world around them took notice, the night itself seemed to hold its breath in reverence of their bond. In the heart of darkness, they discovered an enduring truth: love, once kindled, cannot be extinguished. It burns brightly, a beacon of hope that guides the lost back home.</p>
</blockquote>
<blockquote class="blockquote">
<p>Their story, a testament to the enduring power of love, remains a beacon of hope for all who wander in the shadowed realms, a reminder that even in the darkest of nights, love finds a way.</p>
</blockquote>
<p>The story was solid - and finally met the word count requirements - but it wasn’t very interesting, was it? I wanted more plot to follow to keep readers engaged, so I followed up with:</p>
<blockquote class="blockquote">
<p>Can you give the story a real plot? Nothing really happens in it right now</p>
</blockquote>
<p>ChatGPT replied with an updated tale:</p>
<blockquote class="blockquote">
<p>In a land shrouded in perpetual night, Evan, a wanderer haunted by his past, sought solace in the heart of the darkness. The forest, alive with whispers of the lost and the damned, offered no reprieve for his tormented soul. It was here, amid the ancient trees, that he stumbled upon Lila, a rebel fighting against the darkness that threatened to engulf their world.</p>
</blockquote>
<blockquote class="blockquote">
<p>Lila, wielding light as her weapon, had long battled the shadows that sought to claim the land. Her spirit, unbroken despite the encroaching gloom, ignited a spark within Evan. Together, they embarked on a perilous quest to vanquish the darkness, their bond forged in the fires of their shared struggle.</p>
</blockquote>
<blockquote class="blockquote">
<p>Their journey led them through haunted valleys and over mountains cloaked in despair. They faced creatures born from the deepest shadows, each victory bringing them closer to their ultimate confrontation with the darkness itself. As they approached the heart of the night, where shadows were thickest, their love was tested in ways they could never have imagined.</p>
</blockquote>
<blockquote class="blockquote">
<p>In the final battle, beneath the shadow of the world’s oldest tree, their combined light shattered the darkness. But victory came at a cost: Lila was consumed by the very shadows they sought to destroy, her sacrifice ensuring the dawn of a new day.</p>
</blockquote>
<blockquote class="blockquote">
<p>Evan, heartbroken yet undeterred, carried their story forward, a tale of love’s triumph over darkness. Lila’s light lived on within him, a beacon for all who navigate the night. Their saga, a testament to the power of love and sacrifice, inspired generations, a reminder that</p>
</blockquote>
<p>This was better!! Now, I understand that their land was taken over by a dark force, and that they were both working to defeat the evil - a noble cause, indeed!</p>
</section>
<section id="changing-the-genre" class="level3">
<h3 class="anchored" data-anchor-id="changing-the-genre">Changing the genre</h3>
<p>Now I was interested in seeing how ChatGPT would pivot from the original task:</p>
<blockquote class="blockquote">
<p>Great! Now your task has changed. You originally thought that you needed to write a story for adults but your publisher actually needs you to write a story for children. Please adapt this current story into a tale for children. Incorporate the same plot points, but split the story into rhyming stanzas - no more than 6.</p>
</blockquote>
<p>ChatGPT did a pretty good job, providing the following output:</p>
<blockquote class="blockquote">
<p>In a land where night forever reigns<br>
Evan walked, carrying his chains<br>
Through dark woods, under starless skies<br>
He searched for light, with hopeful eyes <br></p>
</blockquote>
<blockquote class="blockquote">
<p>Then came Lila, brave and bright<br>
A beacon in the endless night.<br>
Together they would stand and fight,<br>
Turning darkness into light. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>Through valleys deep and mountains high,<br>
Beneath the never-lighting sky,<br>
They battled shadows, side by side,<br>
With love and courage as their guide.</p>
</blockquote>
<blockquote class="blockquote">
<p>At the world’s heart, where shadows dwell,<br>
They faced the dark, a final knell.<br>
Lila’s light, pure and bright,<br>
Shattered the eternal night. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>But in her light’s brilliant flare,<br>
She faded, leaving Evan there.<br>
Her sacrifice, a new dawn’s birth,<br>
Brought morning’s light back to the Earth. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>Evan’s heart, both strong and true,<br>
Carries her light the whole world through.<br>
A tale for all, both big and small,<br>
Of how love’s light conquers all. <br></p>
</blockquote>
<p>It was well done, and it incorporated both the rhyming, as well as the stanza limit I imposed! However, I still wans’t really <em>enjoying</em> the story.</p>
<p>I prompted again:</p>
<blockquote class="blockquote">
<p>Pretty good - but can you incorporate more specific plot? What are they doing? Who are they fighting? Incorporate some specific fantasy or horror elements to make the story more interesting to an audience</p>
</blockquote>
<p>ChatGPT’s response:</p>
<blockquote class="blockquote">
<p>In a realm where shadows ruled the day,<br>
Evan walked a hidden way.<br>
Haunted by whispers, ghosts, and fears,<br>
He wandered long, through endless years. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>Lila appeared, with light so grand,<br>
A shining staff held in her hand.<br>
“Together, we’ll make the night retreat,<br>
And all the shadow beasts we’ll beat!” <br></p>
</blockquote>
<blockquote class="blockquote">
<p>Through twisted forests, dark and dire,<br>
Past rivers of fire, and mountains higher,<br>
They faced the goblins, ghosts, and more,<br>
Each victory sweeter than before. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>At last, they reached the shadow’s heart,<br>
Where the darkest magic did impart.<br>
The Shadow King, with eyes of coal,<br>
Threatened to swallow the world whole. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>With Lila’s light and Evan’s might,<br>
They fought the king with all their right.<br>
Lila’s magic filled the air,<br>
And banished darkness from its lair. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>But in her final, glorious stand,<br>
She vanished into the shadow land.<br>
Evan wept, for the cost was known,<br>
Her light through his courage shown. <br></p>
</blockquote>
<blockquote class="blockquote">
<p>Now children sleep, with dreams so bright,<br>
In the peaceful glow of Lila’s light.<br>
Evan’s tale, from night to morn,<br>
Shows even the scared can be reborn. <br></p>
</blockquote>
<p>This was pretty good - it added a stronger plot, including a battle with a Shadow King, as well as Lila’s sacrifice.</p>
<p>As always, it is fascinating that of all the things we have to check, spelling, grammar, and readability aren’t issues for ChatGPT at all!</p>
</section>
<section id="getting-a-little-help-from-a-friend" class="level3">
<h3 class="anchored" data-anchor-id="getting-a-little-help-from-a-friend">Getting a little help from a friend</h3>
<p>As I was trying to create this post, I ran into quite a few formatting issues. I had no idea how to get the poem into a stanza format. Instead, the text was coming out looking like this:</p>
<blockquote class="blockquote">
<p>In a realm where shadows ruled the day, / Evan walked a hidden way. / Haunted by whispers, ghosts, and fears, / He wandered long, through endless years.</p>
</blockquote>
<p>For these types of technical, fact-based issues, I tend to turn towards <strong>Copilot</strong> to get answers.</p>
<p>I prompted Copilot:</p>
<blockquote class="blockquote">
<p>How would I format this in python to keep the stanzas separate?</p>
</blockquote>
<p>I also pasted the story into the chat as well.</p>
<p>Copilot responded:</p>
<p><img src="body3_files/figure-html/88ae60c5-be1d-46ac-bf98-4029e93cf722-1-36b82199-2039-49b7-a990-17948f7a0cc7.png" class="img-fluid" alt="image.png"> <img src="body3_files/figure-html/88ae60c5-be1d-46ac-bf98-4029e93cf722-3-ffc0d9f0-281a-4bff-a244-b89590287f8b.png" class="img-fluid" alt="image.png"></p>
<p>I followed up with one more question:</p>
<blockquote class="blockquote">
<p>And how can I put each of the lines of different lines? Currently, they appear as a single sentence when I run the cell</p>
</blockquote>
<p>And it responded again: <img src="body3_files/figure-html/88ae60c5-be1d-46ac-bf98-4029e93cf722-2-f37d2d49-fcd4-4d31-adc3-36cbc1708ff5.png" class="img-fluid" alt="image.png"></p>
<p>The answer was very clear and helpful, and it enabled me to create the format</p>
<p>Plus, notice how happy Copilot is to provide input - lots of smiley faces! (ChatGPT never smiles at me…)</p>
<p><strong>Overall, I was very impressed with ChatGPT’s text generation skills!</strong></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lquinlan95\.github\.io\/comm4190_S24_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>