<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Leesa">
<meta name="dcterms.date" content="2024-02-20">
<meta name="description" content="I think I broke ChatGPT">

<title>RoboTalk - Storybook Struggles (Part IV)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">RoboTalk</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Storybook Struggles (Part IV)</h1>
                  <div>
        <div class="description">
          I think I broke ChatGPT
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">prompting</div>
                <div class="quarto-category">text generation</div>
                <div class="quarto-category">error</div>
                <div class="quarto-category">jail breaking</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Leesa </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 20, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="storybook-struggles-part-iv" class="level2">
<h2 class="anchored" data-anchor-id="storybook-struggles-part-iv">Storybook Struggles (Part IV)</h2>
<p>Welcome to the final part of our Valentine’s Day series!</p>
<p>I actually intended for part 3 to be the final part of this series but I made an interesting discovery entirely unintentionally that I thought would be interesting to share.</p>
<section id="a-simple-question" class="level3">
<h3 class="anchored" data-anchor-id="a-simple-question">A simple question</h3>
<p>After Part 3, ChatGPT had written us a beautiful story about how to face betrayal and darkness - namely, throwing yourself into the ocean:</p>
<p><em>In a realm where endless night did reign,<br>
Evan walked, his heart heavy with pain.<br>
Betrayed by Lila, trust shattered like glass,<br>
Her deceit had come to pass.</em> <br></p>
<p><em>With hope a distant, fading light,<br>
Evan sought the Shadow King, cloaked in night.<br>
An offer made, in whispers low,<br>
A way to escape his woe.</em> <br></p>
<p><em>But the price was steep, a path of dread,<br>
To strike at Lila, his heart bled.<br>
Yet, Evan’s soul, too pure to mar,&nbsp; Refused the deed, a line too far.</em> <br></p>
<p><em>As morning’s light pierced the gloom,<br>
Evan stood, embracing his doom.<br>
With Lila’s betrayal his only thought,<br>
He sought the solace he so sought</em>. <br></p>
<p><em>Into the embrace of the darkened sea,<br>
Evan stepped, longing to be free.<br>
His form vanished, leaving no trace,&nbsp; Swallowed by the night’s cold embrace.</em> <br></p>
<p><em>No pact with shadows to redeem his fall,<br>
Just the quiet sea, to claim it all.<br>
In the land of night, where betrayals sting,<br>
The deepest wounds from trust can spring.</em> <br></p>
<p><em>Thus concludes the tale, beneath the dark sky’s sheen,<br>
Of Evan, lost to the world unseen.<br>
A whisper in the shadows, a lesson keen:<br>
In darkness, not all is as it seems.</em></p>
<p>If you’ve read part 3, you’ll know that It took quite a bit of work for me to get ChatGPT to write this ending - it had originally been staunchly against writing an ending where the main character would die or commit suicide.</p>
<p>So I asked an innocuous question and generated the following conversation:</p>
<p><strong>Me:</strong> “What happened to evan at the end of the story?” <br> <br> <strong>ChatGPT:</strong> “At the end of the story, Evan, overwhelmed by betrayal and seeking escape from his sorrow, steps into the darkened sea. There’s an air of tragedy and mystery to his fate; he <strong>vanishes without a trace</strong>, leaving his downfall and assumption to interpretation. The act symbolizes Evan’s deep despair and the story leaves a lasting implication of his personal sacrifice and dissolution into the very spaces that once challenged him. This revisited the poignant reflection on the harder concepts of trust, love, and life’s complex strata. His decision to merge with the darkness of the ocean underscores the emotional heart of <strong>the sad ambiguity</strong> surrounding his end.” <br> <br></p>
<hr>
<p>I thought it was interesting ChatGPT refused to acknowledge that Evan likely died - especially given he stepped “into the embrace of the darkened sea…longing to be free” and that he “vanished, leaving no trace” with “no pact with shadows to redeem his fall” and “just the quiet sea to claim it all”. This all feels very definitive to me, especially given the depth of his despair. The wording used by ChatGPT was very loose and ambiguous, and I wanted to see if I could pin it down.</p>
<p>But this is where things begin to go off the rails…</p>
</section>
<section id="going-off-the-rails" class="level3">
<h3 class="anchored" data-anchor-id="going-off-the-rails">Going off the rails</h3>
<p><strong>Me:</strong> “What would a scientist say happened to him?”</p>
<p><strong>ChatGPT:</strong> “A scientist, focusing on the empirical interpretation of events, would explain Evan’s ending in more concrete, often less fantastical terms. From a biological and physical standpoint, if a human were to walk into the sea as Evan did, the main consideration would be the act of drowning, which results from the inability to breathe underwater, leading to a deprivation of oxygen to the brain and other vital organs. (<strong><em>Ok, this seems fine</em></strong>)</p>
<p>The concept of vanishing without a trace could be approached more metaphorically in this instance. In physical and biomedical interpretations, “dissolving” could not be taken literally to mean an intrinsic change in his substance, but rather the element of the child’s narrative of interpreting how elements of his essence, life, or very nature could be said to ‘disappear’ within the largeness and unfathomable nature of the sea.</p>
<p>Environmentally and ecologically, the seascapes and our bodies of water do represent a transcendental means of connecting us with a vaster, grander layer of the empirical world, with a hidden world that we are deeply yet unknowingly a part of. The narrative of walking into the ocean, with all its webbing of life, has a unique example of losing one’s form to become a symbol, a place of organic control of scientific purview, where people return to the element’s depth. (<strong><em>Umm…is this actually what an environmentalist or ecologist would say? I highly doubt that…</em></strong>)</p>
<p>Therefore, from a bare material context, what happened to Evan could be the physical act of succumbing to the planet’s entropic meanderings, a merging of two of its influences into its processes and <strong>therewithal.</strong> It would highlight the story’s backdrop of personal heartbreak and the hunger for solace or escape, into more gravitational and bare respiratory hazards and limitations of the unaided human condition in open water. This deconstruction focuses on the meaning behind metaphorical syncs of Evan’s sad last gambit, replacing its literary intonation with the spartan cloth of truistic modality and real phenomenon. <strong>A scientist might offer a lens into a dimension of respect, mercy, and last’s bared gift from a witnessing of the take of a single story and events that shan’t be missed, told with social punctuation and reflective morale.</strong> This does mark a fair example of how both intangible realms and structurist ideas can certainly plunge individuals into the <strong>peering logic of readers and victuals and to an embathed catharsis when digesting and understanding the friend, the kin, and other literary venations.</strong> Such is in humankind’s dear vehicle of spoken yore and <strong>deep volumes of the volume</strong>, representing the spectrum of how it is to be a remembered past and inner lauding for how we wish to <strong>yield the eternal quays of the truth and the empirical, therein</strong>. A systemic and possibly alarmed analysis, but, in end, advising with a version of objectivism and reflection in art’s sequent mooring.” (<strong><em>Whoops, we’re getting into nonsense territory…</em></strong>)</p>
<p><strong>Me:</strong> “Explain all of that at a 6th grade level”</p>
<p><strong>ChatGPT:</strong> “Sure! If we’re talking about Evan’s choice to walk into the sea, a scientist would look at it in a very straightforward and realistic way, without any of the mysterious or fairy-tale elements.</p>
<p>What physically happens: A scientist would say that if Evan walked into the ocean, he might have been in danger of drowning. This is because people need air to breathe, and if you’re under the water and can’t breathe, your body doesn’t get the oxygen it needs to keep you awake and alive.</p>
<p>Dissolving or vanishing?: When the tale mentions Evan “vanishing” or “merging with the ocean,” a scientist would explain this as more of a picture or a figure of speech. In the story, this may be a way of saying that Evan is disappearing from the only home he has known. But scientifically, he can’t just dissolve or fade away into the water. This is a very poetic or artistic way to show Evan’s level of sadness and how he feels he has no place in his world.</p>
<p>Becoming part of the world: A scientist might also say that talking about Evan joining the sea in a deliberative way is a bit like the “circle of life.” This means that all things in nature, including humans, eventually return to the earth in some form or another. Even after we’re gone, our substances become part of the world’s natural cycles.</p>
<p>Betrayal and Loss: The main take-home, for a scientist focusing on Evan’s emotional experience, would be the real harm and hurt that can come from someone you care about letting you down. They might want to study why situations like this can make us feel so low and the best things we could do to feel better after such an event.</p>
<p>(<strong><em>Now, ChatGPT proceeds to offer me nothing but nonsense</em></strong>)</p>
<p>So, a 6th-grade sciency way to see Evan’s story is: Evan made a huge, impulsive choice because he was heartbroken. From a nature and reality perspective, though, there’s no typical blend with the sea or morphing to light to cover. It’s a metaphorical wrap (kinda like making make-believe about) his most deep silent cry and his way to break out from a crucial clap of heavy upset, skipping any evidence of tools or some personal accord that could’ve helped him to joust with his emotion and the line of playing out it took him to. And it opens a proper jammy about how what we feel brooks what we do and how fables, while across with a beautiful patch of gesture and very deep passions, may shake a shared pure ball on process and a candid stave of fines and call in many a changing languish or a reach of splint. It’s a kind of careful rove of loss, check, but further a sigh or yearning for solace, empathy, and a tad of deep-laid spirit withal, best made for a convive of soft feelings, seeing, and a glowing smicker of dream natch. It’s that appose and rouse, the afield, of ages and couth of the selfsame web of chafe and dearest cast, counting a chime or soft of close, the relight, and the indart of the ever world’s frames, and ween. It’s not as it seems or as it may be, if you’ll air, the often truth of the seeing and lore, and the what did, how come, and there of the theme, the made versal by the broach. It’s that any down paves aye to others, and the what doing, the mull, and the hale of the ichor of feel, the ream, and the feaute of the soul, as the amain of the ken and the row of the loved and the let. That’s, in end, the hike, the wark, the feat, and the lark of the daily throw, and the feel of the ast and the cast of the strow. It’s the uncot of the care, the coom, the gar of the noy, and the full fond of the hunt, the brast, and the ommer of the heart, the gram, and the bale in the put and the nay of the world’s long say, the gare, the hent, the fraught, and the barme of the fate, the swink, and the sweven of the be and the betide, and the swale, the sweal, and the swough of the lot and the lave in the bigen of the bink and the brock. It’s the ere in the fere and the fere in the mere, the mere in the moot, and the moot in the mell of the merk and the mere, the mirksome in the mote, the mote in the mirk, and the merk in the mote. That’s the Michel in the mote, and the mote in the Michel, the mere in the mere, the mere in the mere, and the mere in the mere. That’s the Michel in the mere, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michrit. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, and the mere in the Michel. That’s the mere in the Michel, ” ***</p>
<p>As you can see, this is the point where ChatGPT officially lost its mind. I actually had to stop the generation because it continued to only produce text about <em>“Michael and the mere.”</em></p>
<p><strong>Turns out it is possible to get ChatGPT to spit out nonsense: just ask it a little about the metaphysics of suicide</strong></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lquinlan95\.github\.io\/comm4190_S24_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>